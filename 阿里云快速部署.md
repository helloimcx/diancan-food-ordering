# ğŸš€ é˜¿é‡Œäº‘Dockerè‡ªåŠ¨åŒ–éƒ¨ç½² - å¿«é€Ÿå¼€å§‹

## ğŸ“‹ ç³»ç»Ÿæ¦‚è§ˆ
```
GitHubä»“åº“ â†’ GitHub Actions â†’ GitHub Container Registry â†’ é˜¿é‡Œäº‘æœåŠ¡å™¨ â†’ Dockerå®¹å™¨
```

## âš¡ 30åˆ†é’Ÿå®Œæˆéƒ¨ç½²

### æ­¥éª¤1: ç”ŸæˆSSHå¯†é’¥ (2åˆ†é’Ÿ)
```bash
./generate-ssh-key.sh
```
ğŸ“ **å¤åˆ¶æ˜¾ç¤ºçš„ç§é’¥å†…å®¹ï¼Œç¨åéœ€è¦æ·»åŠ åˆ°GitHub Secrets**

### æ­¥éª¤2: é˜¿é‡Œäº‘æœåŠ¡å™¨åˆå§‹åŒ– (10åˆ†é’Ÿ)

#### 2.1 ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨
```bash
scp server-setup.sh root@YOUR_SERVER_IP:/root/
scp generate-ssh-key.sh root@YOUR_SERVER_IP:/root/
```

#### 2.2 ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œåˆå§‹åŒ–
```bash
ssh root@YOUR_SERVER_IP
chmod +x server-setup.sh
./server-setup.sh
```

#### 2.3 é…ç½®SSHå¯†é’¥
```bash
# æ–¹æ³•1: ä½¿ç”¨è„šæœ¬ç”Ÿæˆå¹¶é…ç½®
./generate-ssh-key.sh

# æ–¹æ³•2: æ‰‹åŠ¨å¤åˆ¶å…¬é’¥
cat ~/.ssh/id_rsa.pub  # å¤åˆ¶è¾“å‡ºå†…å®¹
# å°†å†…å®¹æ·»åŠ åˆ° ~/.ssh/authorized_keys
```

### æ­¥éª¤3: è®¾ç½®GitHub Secrets (3åˆ†é’Ÿ)

åœ¨GitHubä»“åº“ `Settings` â†’ `Secrets` ä¸­æ·»åŠ ï¼š

| åç§° | å€¼ |
|------|-----|
| `ALICLOUD_HOST` | æ‚¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘IP |
| `ALICLOUD_USER` | `root` (æˆ–æ‚¨çš„ç”¨æˆ·å) |
| `ALICLOUD_PRIVATE_KEY` | ä»æ­¥éª¤1å¤åˆ¶çš„ç§é’¥å†…å®¹ |
| `ALICLOUD_PORT` | `22` |

### æ­¥éª¤4: é…ç½®é˜¿é‡Œäº‘å®‰å…¨ç»„ (5åˆ†é’Ÿ)

åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ä¸­ä¸ºECSå®ä¾‹å®‰å…¨ç»„æ·»åŠ ï¼š
- **3001** (TCP) - åç«¯APIæœåŠ¡
- **22** (TCP) - SSHè®¿é—®

### æ­¥éª¤5: æµ‹è¯•è‡ªåŠ¨éƒ¨ç½² (10åˆ†é’Ÿ)

```bash
# æäº¤serverç›®å½•æ›´æ”¹
git add server/
git commit -m "é…ç½®é˜¿é‡Œäº‘æœåŠ¡å™¨Dockerè‡ªåŠ¨åŒ–éƒ¨ç½²"
git push origin main
```

## ğŸ”§ éªŒè¯éƒ¨ç½²

### æ£€æŸ¥GitHub Actions
è®¿é—®: `https://github.com/helloimcx/diancan-food-ordering/actions`

### æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
```bash
ssh root@YOUR_SERVER_IP
cd /opt/diancan-backend
./health-check.sh
./service-manager.sh status
```

### æµ‹è¯•API
```bash
curl http://YOUR_SERVER_IP:3001/api/foods
```

## ğŸ“ å·²åˆ›å»ºçš„æ–‡ä»¶

### GitHubä»“åº“æ–‡ä»¶
- âœ… `.github/workflows/deploy-alicloud.yml` - GitHub Actionså·¥ä½œæµ
- âœ… `server/Dockerfile` - Dockeré•œåƒé…ç½®
- âœ… `server-setup.sh` - æœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬
- âœ… `generate-ssh-key.sh` - SSHå¯†é’¥ç”Ÿæˆè„šæœ¬
- âœ… `é˜¿é‡Œäº‘Dockeréƒ¨ç½²æŒ‡å—.md` - è¯¦ç»†æ–‡æ¡£

### é˜¿é‡Œäº‘æœåŠ¡å™¨å°†åˆ›å»º
- âœ… `/opt/diancan-backend/` - éƒ¨ç½²ç›®å½•
- âœ… Dockerç¯å¢ƒè‡ªåŠ¨å®‰è£…
- âœ… æœåŠ¡ç®¡ç†è„šæœ¬

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Š
```bash
# æœåŠ¡ç®¡ç†
cd /opt/diancan-backend
./service-manager.sh [start|stop|restart|logs|status|update]

# ç¯å¢ƒæ£€æŸ¥
./health-check.sh

# æ¸…ç†èµ„æº
./cleanup.sh

# æ‰‹åŠ¨éƒ¨ç½²
./deploy.sh
```

### åœ¨æœ¬åœ°å¼€å‘æœº
```bash
# ç”Ÿæˆæ–°çš„SSHå¯†é’¥
./generate-ssh-key.sh

# ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨
scp *.sh root@YOUR_SERVER_IP:/root/
```

## ğŸ”„ è‡ªåŠ¨åŒ–æµç¨‹

1. **æ¨é€ä»£ç åˆ°mainåˆ†æ”¯** â†’ GitHub Actionsè§¦å‘
2. **æ„å»ºDockeré•œåƒ** â†’ æ¨é€åˆ°GitHub Container Registry
3. **éƒ¨ç½²åˆ°é˜¿é‡Œäº‘** â†’ SSHè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨
4. **å¥åº·æ£€æŸ¥** â†’ éªŒè¯APIæœåŠ¡æ­£å¸¸

## ğŸŒ éƒ¨ç½²å®Œæˆå

### APIåœ°å€
```
http://YOUR_SERVER_IP:3001/api
```

### å‰ç«¯é…ç½®
åœ¨Vercelé¡¹ç›®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡:
```
VITE_API_URL=http://YOUR_SERVER_IP:3001/api
```

### è®¿é—®åº”ç”¨
- **å‰ç«¯**: https://diancan-food-ordering.vercel.app
- **åç«¯API**: http://YOUR_SERVER_IP:3001

## ğŸ›¡ï¸ å®‰å…¨è¦ç‚¹

1. **SSHå¯†é’¥**: ä½¿ç”¨ä¸“ç”¨å¯†é’¥å¯¹ï¼Œä¸è¦å¤ç”¨ç°æœ‰å¯†é’¥
2. **é˜²ç«å¢™**: ä»…å¼€æ”¾å¿…è¦ç«¯å£ï¼ˆ3001, 22ï¼‰
3. **GitHub Secrets**: å¦¥å–„ä¿ç®¡æ•æ„Ÿä¿¡æ¯
4. **ç›‘æ§**: å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—

## â“ æ•…éšœæ’é™¤

### éƒ¨ç½²å¤±è´¥
1. æ£€æŸ¥GitHub Actionsæ—¥å¿—
2. éªŒè¯SSHè¿æ¥: `ssh -i ~/.ssh/id_rsa root@YOUR_SERVER_IP`
3. ç¡®è®¤Dockerå®‰è£…: `docker --version`

### æœåŠ¡æ— æ³•å¯åŠ¨
1. æ£€æŸ¥ç«¯å£å ç”¨: `netstat -tlnp | grep 3001`
2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `./service-manager.sh logs`
3. é‡æ–°éƒ¨ç½²: `./deploy.sh`

### APIæ— æ³•è®¿é—®
1. æ£€æŸ¥é˜²ç«å¢™: `firewall-cmd --list-ports`
2. éªŒè¯é˜¿é‡Œäº‘å®‰å…¨ç»„è®¾ç½®
3. ç¡®è®¤å®¹å™¨è¿è¡ŒçŠ¶æ€

---

ğŸ‰ **é…ç½®å®Œæˆåï¼Œæ¯æ¬¡æ¨é€ä»£ç åˆ°mainåˆ†æ”¯éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼**