#!/bin/bash

# å¿«é€Ÿå…è´¹äº‘å¹³å°éƒ¨ç½²è„šæœ¬
# ä¸“æ³¨Vercelå‰ç«¯éƒ¨ç½²

set -e

# é¢œè‰²å®šä¹‰
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
PURPLE='\033[0;35m'
NC='\033[0m'

echo ""
echo -e "${PURPLE}âš¡ å¿«é€Ÿå…è´¹äº‘å¹³å°éƒ¨ç½²${NC}"
echo -e "${PURPLE}==========================${NC}"
echo ""

# æ£€æŸ¥Vercel CLI
if ! command -v vercel &> /dev/null; then
    echo -e "${YELLOW}å®‰è£… Vercel CLI...${NC}"
    npm install -g vercel
fi

echo -e "${BLUE}ðŸš€ å¼€å§‹Verceléƒ¨ç½²...${NC}"

# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
if [ ! -f "package.json" ]; then
    echo -e "${RED}âŒ è¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæ­¤è„šæœ¬${NC}"
    exit 1
fi

# éƒ¨ç½²åˆ°Vercel
echo -e "${YELLOW}éƒ¨ç½²åˆ°Vercel (å¯èƒ½éœ€è¦ç™»å½•)...${NC}"
vercel --prod

echo ""
echo -e "${GREEN}ðŸŽ‰ Verceléƒ¨ç½²å®Œæˆï¼${NC}"
echo ""

# èŽ·å–éƒ¨ç½²URL
FRONTEND_URL=$(vercel ls --json | grep -o 'https://[^"]*' | head -1 || echo "")

if [ -n "$FRONTEND_URL" ]; then
    echo -e "${BLUE}ðŸŒ å‰ç«¯åº”ç”¨åœ°å€:${NC}"
    echo "$FRONTEND_URL"
    echo ""
    
    # ä¿å­˜éƒ¨ç½²ä¿¡æ¯
    cat > å¿«é€Ÿéƒ¨ç½²ç»“æžœ.txt << EOF
å®¶åº­ç‚¹é¤åº”ç”¨ - å¿«é€Ÿäº‘å¹³å°éƒ¨ç½²ç»“æžœ
=====================================

éƒ¨ç½²æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')

ðŸŒ å‰ç«¯åº”ç”¨åœ°å€: $FRONTEND_URL

ðŸ“‹ è¯´æ˜Ž:
- å‰ç«¯å·²éƒ¨ç½²åˆ° Vercel (å…è´¹)
- åŽç«¯APIä»åœ¨æœ¬åœ°è¿è¡Œ
- é€‚åˆå¼€å‘å’Œæµ‹è¯•ä½¿ç”¨

ðŸ“± ä½¿ç”¨æ–¹æ³•:
1. æ‰“å¼€ $FRONTEND_URL
2. å¼€å§‹ä½¿ç”¨ç‚¹é¤åº”ç”¨
3. æœ¬åœ°åŽç«¯APIå¿…é¡»ä¿æŒè¿è¡Œ

âš ï¸ é‡è¦æé†’:
- éœ€è¦ä¿æŒæœ¬åœ°åŽç«¯APIè¿è¡Œ
- å»ºè®®å‡çº§ä¸ºå®Œæ•´äº‘å¹³å°éƒ¨ç½²æ–¹æ¡ˆ

âœ… ä¸‹ä¸€æ­¥:
./å…è´¹äº‘å¹³å°ä¸€é”®éƒ¨ç½².sh (å®Œæ•´éƒ¨ç½²)
./æ‰‹æœºè®¿é—®éƒ¨ç½².sh (å†…ç½‘ç©¿é€)
EOF
    
    echo -e "${GREEN}âœ… éƒ¨ç½²ä¿¡æ¯å·²ä¿å­˜åˆ° 'å¿«é€Ÿéƒ¨ç½²ç»“æžœ.txt'${NC}"
else
    echo -e "${YELLOW}âš ï¸ è¯·æ£€æŸ¥VercelæŽ§åˆ¶å°èŽ·å–éƒ¨ç½²URL${NC}"
fi

echo ""
echo -e "${YELLOW}ðŸ’¡ å‡çº§æ–¹æ¡ˆ:${NC}"
echo "å¦‚éœ€å®Œæ•´çš„äº‘å¹³å°éƒ¨ç½² (å‰åŽç«¯éƒ½åœ¨äº‘ç«¯)ï¼Œè¯·è¿è¡Œ:"
echo "./å…è´¹äº‘å¹³å°ä¸€é”®éƒ¨ç½².sh"

echo ""
echo -e "${GREEN}ðŸŽŠ å¿«é€Ÿéƒ¨ç½²å®Œæˆï¼${NC}"