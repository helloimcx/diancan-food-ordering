# 🚨 阿里云Docker部署状态报告

## 📊 当前状态概览

### ✅ 已完成的配置
- [x] **GitHub Actions工作流** - 自动检测推送触发部署
- [x] **Dockerfile配置** - 后端容器化准备就绪
- [x] **服务器设置脚本** - 一键环境初始化
- [x] **SSH密钥生成工具** - 安全认证配置
- [x] **预检查脚本** - 环境验证工具

### ❌ 当前问题
- **GitHub Actions状态**: `failed` (失败)
- **运行时间**: 2025-11-23 03:10:40
- **失败原因**: 缺少必要的GitHub Secrets配置

## 🎯 立即可执行的解决方案

### 方案1: 快速部署到Railway (推荐)

如果阿里云服务器尚未准备就绪，可以先使用Railway进行快速部署：

```bash
# 一键Railway部署
./railway-deploy.sh
```

**优势**: 5分钟内完成，无需配置复杂的环境
**缺点**: 免费额度限制，月100小时运行时间

### 方案2: 完成阿里云部署配置

如果已有阿里云服务器，按以下步骤操作：

#### 第一步: 生成SSH密钥 (2分钟)
```bash
./generate-ssh-key.sh
```
**复制显示的私钥内容**

#### 第二步: 配置GitHub Secrets (3分钟)
在 `https://github.com/helloimcx/diancan-food-ordering/settings/secrets/actions` 添加：
```
ALICLOUD_HOST: 您的服务器IP
ALICLOUD_USER: root  
ALICLOUD_PRIVATE_KEY: 复制的私钥内容
ALICLOUD_PORT: 22
```

#### 第三步: 服务器初始化 (10分钟)
```bash
# 上传并运行设置脚本
scp server-setup.sh root@YOUR_SERVER_IP:/root/
ssh root@YOUR_SERVER_IP
chmod +x server-setup.sh
./server-setup.sh
```

#### 第四步: 安全组配置 (5分钟)
在阿里云控制台中为ECS实例安全组添加：
- **3001** (TCP) - API服务端口
- **22** (TCP) - SSH管理端口

#### 第五步: 测试部署 (10分钟)
```bash
git add server/
git commit -m "测试阿里云Docker自动化部署"
git push origin main
```

## 🔍 问题诊断工具

运行预检查脚本验证环境：
```bash
./pre-deploy-check.sh
```

如果仍然失败，查看详细日志：
- GitHub Actions: https://github.com/helloimcx/diancan-food-ordering/actions
- 点击 "阿里云服务器Docker部署" 查看失败步骤

## 🌐 部署完成后的应用访问

### 成功部署后
- **前端应用**: https://diancan-food-ordering.vercel.app
- **后端API**: `http://YOUR_SERVER_IP:3001/api`

### 更新Vercel配置
在Vercel项目设置中添加环境变量：
```
VITE_API_URL=http://YOUR_SERVER_IP:3001/api
```

## 🚀 自动化部署流程

一旦配置完成，每次推送代码到 `main` 分支的 `server/` 目录，流程会自动执行：

```
1. 检测到推送 → GitHub Actions触发
2. 构建Docker镜像 → 推送到GitHub Container Registry  
3. SSH连接到阿里云服务器 → 拉取镜像并启动容器
4. 健康检查 → 验证API服务正常
```

## 🔧 管理命令

部署成功后，在阿里云服务器上运行：

```bash
cd /opt/diancan-backend

# 服务管理
./service-manager.sh [start|stop|restart|logs|status|update]

# 环境检查
./health-check.sh

# 清理资源
./cleanup.sh
```

## 📞 需要帮助？

如果遇到问题，请提供：

1. **GitHub Actions失败的详细日志**
2. **服务器操作系统和Docker版本**
3. **SSH连接测试结果**

## 💡 备选方案

如果阿里云部署持续遇到问题：

1. **使用Railway**: 快速云端部署
2. **本地开发**: `npm run dev` + `cd server && npm start`
3. **其他云平台**: Heroku, Render, Fly.io

---

**快速行动**: 如果您现在就有阿里云服务器，立即运行 `./generate-ssh-key.sh` 开始配置！